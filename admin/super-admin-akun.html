<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kelola Akun - Super Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>body { font-family: 'Inter', sans-serif; }</style>
</head>
<body class="bg-gray-100 min-h-screen">

  <!-- Header -->
  <header class="bg-blue-800 text-white px-6 py-4 shadow flex justify-between items-center">
    <h1 class="text-lg font-semibold">Super Admin - Akun Terapis</h1>
    <a href="super-admin-dashboard.html" class="text-sm underline">🔙 Kembali</a>
  </header>

  <!-- Main -->
  <main class="max-w-3xl mx-auto mt-8 bg-white p-6 rounded shadow-md">
    <h2 class="text-xl font-semibold mb-4">👨‍⚕️ Daftar Akun Terapis</h2>
    <table class="w-full text-sm border border-gray-200 mb-6">
      <thead class="bg-gray-100">
        <tr>
          <th class="p-2 border">Nama</th>
          <th class="p-2 border">Email</th>
          <th class="p-2 border">Status</th>
          <th class="p-2 border">Aksi</th>
        </tr>
      </thead>
      <tbody id="akunList"></tbody>
    </table>

    <h2 class="text-lg font-semibold mb-2">➕ Tambah Akun Baru</h2>
    <form id="tambahForm" class="grid grid-cols-1 gap-4 mt-2">
      <input type="text" id="namaBaru" placeholder="Nama Terapis" class="border p-2 rounded" required />
      <input type="email" id="emailBaru" placeholder="Email" class="border p-2 rounded" required />
      <input type="password" id="passBaru" placeholder="Password" class="border p-2 rounded" required />
      <button type="submit" class="bg-blue-700 text-white px-4 py-2 rounded hover:bg-blue-800">Tambah</button>
    </form>

    <p id="notif" class="text-sm text-green-600 mt-4 hidden">✅ Akun berhasil ditambahkan</p>
  </main>

  <!-- Firebase -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDng3ugBylPgzuxZA1YRPavo5br5jjlodo",
      authDomain: "fisiosehat-af9f1.firebaseapp.com",
      projectId: "fisiosehat-af9f1",
      storageBucket: "fisiosehat-af9f1.appspot.com"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    const akunList = document.getElementById("akunList");

    // 🔁 Ambil semua akun dari collection 'terapis'
    db.collection("terapis").get().then(snapshot => {
      snapshot.forEach(doc => {
        const t = doc.data();
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="p-2 border">${t.nama || "-"}</td>
          <td class="p-2 border">${doc.id}</td>
          <td class="p-2 border">${t.status || "tidak"}</td>
          <td class="p-2 border space-x-2 text-center">
            <button onclick="resetPassword('${doc.id}')" class="text-blue-600 underline text-xs">Reset</button>
            <button onclick="hapusAkun('${doc.id}')" class="text-red-600 underline text-xs">Hapus</button>
          </td>`;
        akunList.appendChild(tr);
      });
    });

    // 🔐 Reset password
    function resetPassword(email) {
      if (confirm("Kirim email reset password ke " + email + "?")) {
        auth.sendPasswordResetEmail(email)
          .then(() => alert("✅ Link reset telah dikirim ke email"))
          .catch(err => alert("Gagal: " + err.message));
      }
    }

    // 🗑 Hapus akun
    function hapusAkun(email) {
      if (!confirm(`Yakin ingin menghapus akun ${email}?`)) return;
      db.collection("terapis").doc(email).delete()
        .then(() => location.reload())
        .catch(err => alert("Gagal menghapus: " + err.message));
    }

    // ➕ Tambah akun
    document.getElementById("tambahForm").addEventListener("submit", async e => {
      e.preventDefault();
      const nama = document.getElementById("namaBaru").value;
      const email = document.getElementById("emailBaru").value;
      const pass = document.getElementById("passBaru").value;

      try {
        const user = await auth.createUserWithEmailAndPassword(email, pass);
        await db.collection("terapis").doc(email).set({
          nama,
          status: "tidak"
        });
        document.getElementById("notif").classList.remove("hidden");
        setTimeout(() => location.reload(), 1500);
      } catch (err) {
        alert("Gagal tambah akun: " + err.message);
      }
    });
  </script>
</body>
</html>
